\section{Introduction}
\label{sec:intro}

% contexto
Feature modeling is a well known technique for 
representing the concepts of a software domain. In fact, 
systematic reuse and domain driven approaches, such 
as Software Product Line~\cite{Clements:2001aa,Pohl:2005aa}, 
Generative Programming~\cite{Czarnecki:2000aa}, and Software 
Factories~\cite{Greenfield:2003aa}, rely on some kind of feature based notation. 
% problema
However, despite the recent proposals for defining the semantics~\cite{Schobbens:2007aa} and for reasoning 
about feature models, there is still a lack of definitions regarding \emph{type-checking} 
and \emph{well-formedness rules} of feature models. Even being well typed, a feature model may
be badly structured. Similar to programs~\cite{Fowler:1999aa}, there are a number of symptoms,
also known as bad smells, that can be useful for identifying them.

%\Fix{Rohit: eu ainda acho que ser satisfativel nao e uma regra de tipo, e sim tem haver com a semantica. Pelos papers que li, nao vi nada falando sobre regras de boa formacao e do sistema de tipos para FMs.o sistema de tipos, nos fizemos mas era bem simples. Acho que as regras de boa formacao sao as mais complicadads de definir (especialmente a completude delas).}
%\Fix{Rodrigo: beleza Rohit. Entao esse eh mais um diferencial do trabalho nosso trabalho em relacao as propostas de Benavides, certo? Ou seja, ele considera um feature model valido quando aceita pelo menos uma instancia. A nossa visao eh diferente, talvez mais ampla...certo? Seria interessante deixar isso mais claro no proximo paragrado.}

%For instance, Benavides and others argue that a feature model is valid if exists at least 
%one selection of features that satisfies the feature model constraints~\cite{Benavides:2005aa}. 
%Although we agree that such a constraint must be satisfied, we have to check other properties 
%in order to assume a feature model as being well typed. For example, according to their point 
%of view, the feature model of Figure~\ref{fig:fm01} would be considered well typed--- actually, there are several 
%valid configurations for this feature model. 

%\Fix{Rohit: Na verdade, acho que eles nao se preocuparam com a boa tipagem. Acredito que eles tenham assumido isso como hipotese do trabalho. Este comentario e o outro foram mais questao de como contar a historia e nao questionando a contribuicao. O exemplo motivante e muito bom. Seria bem interessante se encontrassemos um erro mais complicado e dificil de ver. Talvez a aplicacao de refatoramentos (ver aplicacoes de Rodrigo ou nossas de refatoramentos) pode levar a erros de boa formacao, e nao como um modelo unico.}

%However, we cannot assume the constraint $C\ \Rightarrow\ E$ as 
%being well typed, since it makes references to the a feature (E) that does not exist in the feature model. 
%This problem, which might be motivated by a typographical error, would result in a 
%feature model with a missing constraint. For larger and evolving feature models, 
%checking for these types of errors is mandatory. 

% motivacao no exemplo sobre sistema de tipos
Figure~\ref{fig:fm01} depicts a feature model. To our knowledge there is no formal definition stating what
are the properties that a well typed model must have. This may be useful, for instance, when proposing
feature model transformations. A transformation must transform a well typed model into another well typed
model. It is undesired to introduce type errors. 
% motivacao no exemplo sobre bad smells
When modeling feature models with hundreds of features, its structure may start to degrade.
For example, in the feature model depicted in Figure~\ref{fig:fm01}, notice that 
the mandatory feature B implies the optional feature D. Defining such a kind of constraint 
may be suspicious, since it is similar to changing the cardinality of feature D, which becomes a mandatory 
feature in the presence of this constraint. We consider this a bad design (\emph{bad smell}), and should be reported 
to the domain analyst in order to improve (\emph{refactor}) the underline feature model. 

\begin{figure}[thb]
\begin{center}
\input{images/fm01.pstex_t} 
 \caption{Feature model sample}
 \label{fig:fm01}
\end{center}
\end{figure}

%\Fix{Rohit: seria bom detalhar mais a importancia da formalizacao no paper de AOSD.}
%\Fix{Rodrigo: achei muito interessante a visao que voce apresentou Rohit. No paper de AOSD, o modelo de features eh usado para verificar se a selecao de features que define um produto eh valida. Por outro lado, o modelo de features tem que estar bem tipado para que essa verificacao possa ocorrer. Eh issso que tenho que deixar claro nesse paragrafo, certo?}
%\Fix{Tiago: aqui estamos referenciando muito trabalhos da UFPE, acho que nao pega muito bem pros revisores, melhor aumentar}

% solucao
In this paper, we formalize a type system for feature models. Moreover, we propose a number of bad smells of feature models. Refactorings are also proposed for removing them. The formalization may be useful in some contexts. We explore two of them in Section~\ref{sec:evaluation}.
% aplicacao
% 1. formalizacao do sistema de tipos
% paper de AOSD
For instance, a type checking activity for feature models is an essential step before applying the transformations described by Bonif\'{a}cio and Borba~\cite{Bonifacio:2009aa}, although we believe that it might be also necessary to other approaches for automated product line engineering.
% refatoramentos
This formalization is also useful for proving that FM refactorings~\cite{Alves:2006aa} do not introduce type errors. So, besides showing that the resulting FM contains all configurations of the initial one, we must prove that from a well formed FM, the resulting FM is always well-formed.

% 2. bad smells
Besides exploring type errors, we explore symptoms that may suggest bad designs. Detecting bad smells is an essential practice for the reactive approach of SPL development, since it can detect recurrence faults when modeling and evolving large feature models (with thousands of features and constraints). 
% resumo
Therefore, the contributions of this paper are three-fold:
\begin{itemize}
\item formalize well-formedness rules and a type system that must be 
obeyed in order to consider a feature model well-typed (Section~\ref{sec:type-checker});
\item propose a catalog of bad smells for feature modeling, 
which can help business analysts to find out common faults when 
designing and evolving feature models (Section~\ref{sec:bad-smells}); and
\item present the tool support used for checking whether a feature model 
is well typed, for detecting bad smells and applying some refactoring for
removing them (Section~\ref{sec:tool-support}). 
\end{itemize}


%\Fix{Acho que tem que relacionar mais a contribuicao do type checking com a contribuicao dos bad smells - nao tá muito claro qual a relação entre eles. Por exemplo, poderiamos questionar se bad smells só ocorrem em modelos bem ou mal tipados?}

%We also show that the proposed tool scales to XYZ features (Section~\ref{sec:evaluation}).  

%\Fix{Rodrigo: acho que a formalizacao eh melhor expressa em Alloy, alem de ganharmos um analisador de graca--- existem checkers para Haskell, mas temos que escrever algum codigo para usa-los.  Em termos de suporte ferramental, ai poderiamos pensei em estender as bibliotecas Haskell, que hoje jah possuem interface (por meio de parsers) com fmide, e fmp. Temos que decidir se eh valido ter essas duas visoes no paper, ou usar apenas Alloy. Caso apresentemos um suporte ferramental alem do analisador Alloy, teriamos que ver como encaixar e justificar. Em SPLC, acho que descrever um suporte ferramental pode render alguns pontos.}

%\Fix{Tiago: se usarmos Haskell, qual é a vantagem de uma abordagem funcional? mais expressividade em descrever regras de tipo? acho que desempenho não é...}

%Additionally, we compare our work to the body of knowledge related to feature
%model semantics, reasoning and refactoring (Section~\ref{sec:related}). Finally, 
%some concluding remarks and future work proposals are presented in 
%Section~\ref{sec:concluding}.

