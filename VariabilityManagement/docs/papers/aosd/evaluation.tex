%=============================
% Evaluation
% ============================
\section{Evaluation}
\label{sec:evaluation}

We have applied our approach to four SPLs: the eShop Product Line, introduced in
Section~\ref{sec:problem}; the {\bf Pedagogical Product Line
(PPL)}~\cite{ppl-url}, which was proposed for learning about and experimenting
with software product lines and focus on the arcade game domain; the {\bf Smart
Home Product Line}, whose specification was besed from different
works~\cite{Pohl:2005aa}, and the {\bf Multimedia Message Product Line (MMS)},
a case study conduced with one of our industrial patterns. The MMS-PL allows the
assembling of specific products for creating, sending, and receiving multimedia
messages (MMS) in mobile phones~\cite{Bonifacio:2008aa}.

Based on this last case study, we noticed the benefits of a clear separation
between variability management and scenario
specification~\cite{Bonifacio:2008aa}. In this previous work, we compared our
approach with the PLUC and PLUSS techniques. Such a comparison considered
different evaluation tools: Design Structure Matrices (DSMs), a suite of metrics
for quantifying modularity and complexity of specifications, and observations of
the effort required to introduce SPL increments (e.g. introducing new variants or
products). It is important to note that we didn't formalize \emph{variability
management as crosscutting} in our previous work~\cite{Bonifacio:2008aa}; we just
report on the benefits related to the \emph{separation of concerns} (SoC) claimed
in this paper.

In the remaining of this section we first present a new suite of metrics,
proposed to mitigate some problems identified in previous evaluations of our
work. Then we describe the assessment procedure followed during the Smart Home
MMS, and PPL case studies. Finally, we present some conclusions acquired from
these different product lines.

\subsection{Metric suite}\label{sub:metric-suite}

In a previus work, we evaluated the benefits of a clear SoC between variability
assets and common software engineering models. In order to do that, we first
customized a suite of metrics, applied in several empirical
studies~\cite{Garcia:2005aa,Greenwood:2007aa,Figueiredo:2008ab,Figueiredo:2008ab}
related to AOP, and quantified feature scattering and scenario cohesion. Three
metrics were applied in order to reason about modularity: \emph{feature diffusion
over scenarios}, \emph{feature diffusion over steps}, and \emph{number of
features} related to each scenario.

However, using these metrics we were not able to understand the degree of
scattering (or degree of tangling) of a feature, which difficults the comparison
between different specifications. Therefore, in order to mitigate this problem,
in this paper we are adapting the metric suite proposed by Eaddy et
al.~\cite{Eaddy:2007aa}. This suite considers the degree of scattering of
features (concerns in the original paper) and degree of focus of scenarios
(componentes in the original paper). Additionally, Eaddy et
al.~\cite{Eaddy:2007aa} proposed a \emph{prune dependency analysis} to assign
concerns to lines of source code. In a similar way, we define a
\emph{configuration dependency analysis} to assign features to steps of
scenarios.

\begin{definition}
The \emph{configuration dependency analysis} is used as a guideline to assign
features to steps of scenarios. If the configuration of a feature $f$
affects the selection or the configuration of a step $s$, we assume that this step has a
dependency with the feature $f$.
\end{definition}

Thus, we can customize both metrics (degree of scattering and degree of fucus)
to our context. First, the \emph{degree of scattering} of a feature $f$ is
calculated by normalizing its concentration regarded to each scenario $s \in
S$ (the set of all scenarios).

\begin{center}
$DOS(f) = 1 - \frac{S \sum_{s}^{S}(CONC(f,s)-\frac{1}{S})^2}{S-1}$, where:

$CONC(f,s) = \frac{number\ of\ steps\ in\ s\ assigned\ to\ f}{total\ number\
of\ steps\ assigned\ to\ f}$
\end{center}

Likewise, we can calculate the \emph{degree of focus} of a scenario $s$ by
normalizing its dedication regarded to each feature $f \in F$ (the set of
all features).

\begin{center}
$DOF(s) = \frac{F \sum_{f}^{F}(DEDI(s,f)-\frac{1}{F})^2}{F-1}$, where:

$DEDI(s,f) = \frac{number\ of\ steps\ in\ s\ assigned\ to\ f}{total\ number\
of\ steps\ in\ s}$
\end{center}

These metrics inherit the same properties of the original
ones~\cite{Eaddy:2007aa}. However, it is important to enforce that (a)
\emph{degree of scattering} is normalized between 0 (completely localized) and 1 (completely
delocalized); and (b) degree of focus is also normalized between 0 (completely
unfocused) and 1 (completely focused).

The next section describes the workflow followed during the Smart Home
case study, which was evaluated using the metrics described in this section.

\subsection{Smart Home assesment}

This study was divided in four major phases: (1) the specification of the input
data --- three different configurations of the security module of a smart home
were specified without PL support; (2) the presentation of preparatory classes to the subjects
(graduate students with similar skills in the area); (3) the activity of
restructuring the input specifications using both PLUSS and the Crosscutting
technique; and (4) the assesment of the resulting specifications.

In the first phase we have specified three different configurations of the
security module of a Smart Home. These specifications included feature models and
use case scenarios written without product line support. Additionaly, they were
build upon the documentation available from~\cite{Pohl:2005aa,AMPLE}.

In the second phase, introductory classes and bibliographic references were
offered to post-graduate students. At that period, none of these students had
had previous knowledge in the field of scenario variability management. A total of six
students were involved in this case study. Then, the students were organized in
groups and assigned to restructure the input specifications using PLUSS and
Crosscutting techniques.

Table~\ref{tab:sh-dof} sumarizes the resulting \emph{degree of scattering} of
Smart Home features, computed for both PLUSS and Crosscutting approaches. Althoug the
Crosscutting approach achieved a central tendency (median) of DoS closer to
zero, we can not realize any significant improvement in this metric. Actually, for some
features, the DoS for the Crosscutting approach presented a greater value than
the corresponding one in the PLUSS.

\begin{table}[htb]
\centering
\caption{Summary of DoS for the Smart Home case study}
\label{tab:sh-dos}
\begin{small}
\begin{tabular}{llllll} \hline
					& Min 	& Median 	& Mean 	& Max 	& St. Deviation \\ \hline \\
	PLUSS			& 0.00  & 0.26   	& 0.28  & 0.70 	& 0.08 			\\
	Crosscutting	& 0.00  & 0.00  	& 0.26 	& 0.82 & 0.10  		\\ \hline	
\end{tabular}
\end{small}
\end{table}

For instance, the feature \emph{Request Access to Home} in the Crosscutting
approach has a DoS equals to $0.82$. Instead, the same feature in PLUSS has a
DoS equals to $0.53$. The behavior of this feature is influenced by different
options, such as the security mechanism ($Password$ or $Finger Print$).
In the Crosscutting approach, modularizing the varying behavior in
aspectual scenarios increased the DoS of this feature.
On the other hand, the feature \emph{Turn On Internal and External Lights}
presents a lower DoS in the Crosscutting approach (0.00) when compared to the
PLUSS (0.54) notation. This feature requires a behavior that crosscuts, in a
homogenous way, the different scenarios related to the $Intrusion\ Detection$
use case.

Considering the degree of focus (data sumarized in Table~\ref{tab:sh-dof}), we
can realize a significant improvement of the Crosscutting approach
($p-value=0.06$). Notice that the central tendency (median) of DoF in the
Crosscutting approach ($1.00$) is closer to one than the corresponding value
($0.63$) in the PLUSS notation.

\begin{table}[htb] \centering
\caption{Summary of DoF for the Smart Home case study}
\label{tab:sh-dof}
\begin{small}
\begin{tabular}{llllll} \hline
					& Min 	& Median 	& Mean 	& Max 	& St. Deviation \\ \hline \\
	PLUSS			& 0.33  & 0.63   	& 0.68  & 1.00 	& 0.07 			\\
	Crosscutting	& 0.35  & 1.00   	& 0.82 	& 1.00 	& 0.05			\\ \hline	
\end{tabular}
\end{small}
\end{table}

Describing all variants of a behavior in a single asset
(Section~\ref{sec:problem}) is the main reason for the lack of focus in scenarios
written in the PLUSS approach. On the other hand, the Crosscutting approach
allows the modularization of varying behavior in aspectual scenarios. The result
is a better separation between common and optional steps of a scenario.

In summary, the Smart Home case study revealed to us that removing tangling by
means of aspectual scenarios improves the \emph{degree of focus}. Moreover, if
the varying steps of a scenario corresponds to a homogeneous crosscuting
behavior, modularizing it as an aspectual scenario also improves the DoS. On the
other hand, modularizing features affected by heterogeneous crosscutting
behavior increases the corresponding \emph{degree of scattering}.

The next sections present the evaluation of the Pedagogical Product Line (PPL)
and Multimedia Message Product Line (MMS). We compared our specification of
\emph{MMS} product line to the specifications we had written for both PLUC and
PLUSS techniques. Similarly, we compared our specification
of the PPL to a specification that had been sent to us by
the authors of the PLUSS approach.

\subsection{MMS Product Line}

As explained earlier, the MMS product line, which was adapted from an industrial
pattern, enables the customization of multimedia message applications. The
primary goal of each one of these applications is to create and send messages
with embedded multimedia content (image, audio, video)~\cite{Bonifacio:2008aa}.
We have specified the MMS product line using both Crosscutting and PLUSS
techiniques. After that, we evaluated these specifications observing the metric
suite presented in Section~\ref{}. The results of this evaluation are summarized
in Table~\ref{tab:mms-dos} and in Table~\ref{tab:mms-dof}.

\begin{table}[htb] \centering
\caption{Summary of DoS for the MMS case study}
\label{tab:mms-dos}
\begin{small}
\begin{tabular}{llllll} \hline
					& Min 	& Median 	& Mean 	& Max 	& St. Deviation \\ \hline \\
	PLUSS			& 0.00  & 0.60   	& 0.46  & 0.80 	& 0.11 			\\
	Crosscutting	& 0.00  & 0.41   	& 0.34 	& 0.79 	& 0.10			\\ \hline	
\end{tabular}
\end{small}
\end{table}

This case study, differently from the Smart Home, revealed improvements of the
Crossucutting approach with respect to the feature's \emph{degree of scattering}
($p-value=0.01$). This result was mainly achieved because some of the features of
the MMS product line require an homegeneous crosscutting behavior. For example,
there are some policies related to DRM\footnote{Digital Rights Management}
content that crosscutt, in a uniform manner, the behavior related to
\emph{sending} and \emph{forwarding} messages.

On the other hand, the MMS case study didn't reveal significant improvements with
respect to the \emph{degree of focus} metric(Table~\ref{tab:mms-dof}). This
result is also different from the corresponding one observed in the Smart Home
case study. The main reason for such a difference is that several scenarios of
the Smart Home specification are affected by alternative features. On the other
hand, just a few scenarios of the MMS case study are affected by alternative
features. Thus, the benefits achieved from extracting varying behavior to
aspectual scenarios were minimized in this case study.

\begin{table}[htb] \centering
\caption{Summary of DoF for MMS case study}
\label{tab:mms-dof}
\begin{small}
\begin{tabular}{llllll} \hline
					& Min 	& Median 	& Mean 	& Max 	& St. Deviation \\ \hline \\
	PLUSS			& 0.34	& 0.59		& 0.70	& 1.00	& 0.07			\\
	Crosscutting	& 0.46  & 0.59   	& 0.71 	& 1.00 	& 0.06			\\ \hline	
\end{tabular}
\end{small}
\end{table}

The next section presents the final case study. Similarly to the Smart Home
product line, the PPL have been used in several case studies \ldots

\subsection{Pedagogical Product Line}

We compared our approach against a PPL specification that was sent to us by the authors of the PLUSS technique. The original specification of PPL is already well modularized, since its features, in general, are not crosscutting among different use cases. Moreover, another characteristic of the PPL is that several features are related to qualities that do not cause effect into use case specifications. Still in this context, our approach also achieves some improvements in the resulting specifications (Table~\ref{tab:ppl-dos} and Table~\ref{tab:ppl-dof}). For almost all features we were able to improve the DoS ($p-value=0.008$).  

\begin{table}[htb] \centering
\caption{Summary of DoS for PPL case study}
\label{tab:ppl-dos}
\begin{small}
\begin{tabular}{llllll} \hline
					& Min 	& Median 	& Mean 	& Max 	& St. Deviation \\ \hline \\
	PLUSS			& 0.00	& 0.48		& 0.32	& 0.71	& 0.08			\\
	Crosscutting	& 0.00  & 0.00   	& 0.07 	& 0.64 	& 0.05			\\ \hline	
\end{tabular}
\end{small}
\end{table}


Modularizing the error handling feature was the main reason for the aforementioned improvements. By
applying our approach, all behavior related to the \emph{error handling} concern
was specified in a single scenario. The composition of \emph{error handling} with
the basic scenarios was done by means of annotations attributed to the
corresponding steps. For instance, Figure~\ref{fig:error-handle} depicts just one
scenario for error handling: raising  an error when there is no space available.

% \begin{figure}[h] \begin{scriptsize} \texttt{ \begin{tabular}{l}
%      Description: There is no available space in file system.\\
%      From step: [CatchFileException] \\
% To step: END \end{tabular} \begin{center}
% \begin{tabular}{|p{0.1in}|p{0.6in}|p{1.0in}|p{1.0in}|} \hline Id & User Action
% & System State & System Response \\ \hline \hline E1 & & There is not enough
% space to save the file. &  Raise the Disk is Full exception. The arcade game
% application is finished. \\  \hline \end{tabular} \end{center} }
% \end{scriptsize} \caption{Scenario of error handle use case.}
% \label{fig:error-handle} \end{figure}

Notice that this scenario can be started from any step that has been marked with
the \emph{CatchFileException} annotation.
Several features of the PPL need to save information in the file system.
Therefore, in the PLUSS specifications of the \emph{Pedagogical}
product line, several use cases were specified with scenarios for handling this
kind of exception.

As a consequence, we achieve a reduction (almost 20\%) in the number of
specification steps (SS in Table~\ref{tab:ppl-metrics}) when comparing to the
PLUSS approach. It is important to notice that this reduction of size does not
compromise the requirement coverage; but actually it represents an improvement in
the specification reuse.

For concluding our Pedagogical product line analysis, we can realize, based on
Table~\ref{tab:ppl-metrics}, that our approach achieved real benefits only in the
complexity metrics. This result comes from the non crosscutting nature of PPL
features. Comparing to the MMS product line results, we argue that the benefits
of applying our approach should be greater in contexts where features can not be
well modularized using existing techniques. 